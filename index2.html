<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>AIno bot</title>
		<link rel="stylesheet" type="text/css" href="ainobot-1.0.1.css">
		<link rel="stylesheet" href="main.min.css">
		<script type="text/javascript" src="https://static.sketchfab.com/api/sketchfab-viewer-1.0.1.js"></script>
		<script type="text/javascript" src="character-1.0.1.js"></script>
		<script src="annyang.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script src='https://code.responsivevoice.org/responsivevoice.js'></script>
	</head>
	<body>

	<!-- DRAW 3D CHARACTERS -->
		<!-- Hidden buttons used to control playing/pausing the 3D animation -->
		<p align="right" class="hidden">
			<button id="_play" type="button" title="play">play</button>
			<button id="_stop" type="button" title="stop">stop</button>
		</p>


		<!-- Insert an empty iframe for AIno 3D animation -->
		<iframe src="" id="aino-dancing" style="height: auto; border: none;" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" class="hidden"></iframe>
		<iframe src="" id="aino-idle" style="height: auto; border: none;" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" class="hidden"></iframe>
		<iframe src="" id="aino-talking" style="height: auto; border: none;" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" class="hidden"></iframe>
		 <!-- Insert an empty iframe, hidden by default using a class-->
		<!-- Initialize the viewer -->
    <script type="text/javascript">

		ainoIdle();
	       	ainoDancing();
		ainoTalking();


    </script>

	<!-- START SPEACH -->

    <section id="section_hei" class="sec">
      <p id="intro" class="hidden voice_instructions aino-speech">Tervehdys! Olen Ainobot, avustajasi digitalisaatiossa. Voit puhua minulle. Aloita sanomalla "Hei"!"</p>
      <p id="hei" class="hidden aino-speech">Heipä hei! Hauska tutustua. Sanotko ensiksi yrityksesi tai organisaatiosi nimen mahdollisimman selkeästi? Aloita sanomalla "<b>Nimi on</b>..."</p>
			<p id="p_org" class="hidden aino-speech">
				Kuulinko oikein: <input id="aino_org" type="text" class="aino-speech" />? Jos nimi ei ollut ihan oikein, kokeile sanoa oy tai oyj sanan perään tai ääntää englanninkielinen nimi suomalaisittain.
				</br>
				</br>
				Ole hyvä ja vahvista nimi oikeaksi sanomalla "<b>Nimi oikein</b>".
			</p>
			<div id="p_question1" class="hidden aino-speech">
				Valitse paras vaihtoehto sanomalla "Vastaus" ja vastauksen kirjain.
				Kysymys 1: Tärkein syy digitalisaatioon organisaatiossamme on:
				<ul>
					<li>
						<input type="radio" name="question1" id="vastausA1">
						<label for="f-option">A) Organisaationi saa digitaalisuudesta suhteellista etua muihin nähden, olemme jo diginatiiveja</label>
						<div class="check"></div>
					</li>
					<li>
						<input type="radio" name="question1" id="vastausB1">
						<label for="f-option">B) Digitaalisuuden saavuttamiseksi nykyisiä toimintamalleja tai tietojärjestelmiä ei tarvitse muuttaa kovin paljon</label>
						<div class="check"></div>
					</li>

					<li>
						<input type="radio" name="question1" id="vastausC1">
						<label for="f-option">C) Kilpailutilanne pakottaa meidät digitalisaatioon</label>
						<div class="check"></div>
					</li>
					<li>
						<input type="radio" name="question1" id="vastausD1">
						<label for="f-option">D) Digitalisaatio ei kosketa meitä</label>
						<div class="check"></div>
					</li>
				</ul>
			</div>

			<div id="p_question2" class="hidden aino-speech">
				Kysymys 2. Yhteiskehittely asiakkaiden kanssa ja valmius kumppanuuksiin:

				<ul>
					<li>
						<input type="radio" name="question2" id="vastausA2">
						<label for="f-option">A) Meillä on toimintamallit, alustat ja rajapinnat kunnossa asiakkaiden ja partnereiden kanssa toimimiseen lisäarvoa tuottaen</label>
						<div class="check"></div>
					</li>
					<li>
						<input type="radio" name="question2" id="vastausB2">
						<label for="f-option">B) Kehitämme palveluita yhteistyössä asiakkaiden ja kumppaneiden kanssa lisäarvoa tuottaen, mutta teknologiset ratkaisumme eivät tue sitä hyvin</label>
						<div class="check"></div>
					</li>

					<li>
						<input type="radio" name="question2" id="vastausC2">
						<label for="f-option">C) Teemme yhteiskehittelyä asiakkaiden kanssa mutta kumppanistrategiamme on vielä vaiheessa</label>
						<div class="check"></div>
					</li>
					<li>
						<input type="radio" name="question2" id="vastausD2">
						<label for="f-option">D) Emme tee vielä yhteiskehittelyä asiakkaiden kanssa emmekä ole valmiita avaamaan rajapintoja kumpppaneille</label>
						<div class="check"></div>
					</li>
				</ul>
			</div>

			<div id="p_question3" class="hidden aino-speech">
				Kysymys 3. Digitalisaation esteet:

				<ul>
					<li>
						<input type="radio" name="question3" id="vastausA3">
						<label for="f-option">A) Emme näe mitään isoja esteitä</label>
						<div class="check"></div>
					</li>
					<li>
						<input type="radio" name="question3" id="vastausB3">
						<label for="f-option">B) Organisaation on iso ja muutos on suuri ja tulee viemään pitkään</label>
						<div class="check"></div>
					</li>

					<li>
						<input type="radio" name="question3" id="vastausC3">
						<label for="f-option">C) Digitalisaatioon liittyy turvallisuusuhkia ja muita suuria kustannuksia aiheuttavia muutoksia</label>
						<div class="check"></div>
					</li>
					<li>
						<input type="radio" name="question3" id="vastausD3">
						<label for="f-option">D) Emme tunne vielä tarpeeksi digitalisaation tarvittavia teknologioita ja niiden mahdollisuuksia</label>
						<div class="check"></div>
					</li>
				</ul>
			</div>
			<div id="section_email" class="hidden aino-speech">
				<p>Tuloksesi on <input id="aino_tulos" type="text" class="aino-speech" />
					<img style="width:25%; height:auto;" src="1.png" id="result_img" />
				</p>

				<form name="ainoform" action="index2.html" netlify-honeypot="bot-field" netlify>
					<p class="hidden">
					    <label>Don’t fill this out: <input name="bot-field"></label>
					</p>
					<p>
						<label>Nimeni on: <input type="text" name="name" id="recipient_name"></label>
					</p>
					<p>
						<label>Sähköpostiosoitteeni on: <input type="email" name="email" id="recipient_email"></label>
					</p>
					<p class="hidden">
						<input type="text" name="number" id="recipient_message"></label>
					</p>
					<p class="hidden">
					    <label>Message: <textarea name="message" id="message_text"></textarea></label>
					  </p>
					<p>
						<button type="submit" id="result_form">Send</button>
					</p>
				</form>
			</div>
		</section>
    <div id="unsupported" class="hidden">
      <h4>It looks like your browser doesn't support speech recognition.</h4>
      <p>annyang plays nicely with all browsers, progressively enhancing modern browsers that support the SpeechRecognition standard, while leaving users with older browsers unaffected.</p>
      <p>Please visit <a href="http://www.annyangjs.com/">http://www.annyangjs.com/</a> in a desktop browser like Chrome.</p>
    </div>
		<script>
    "use strict";
		var digipoints_raw = 0; //these points are added everytime user answers question or analysis is ready
		var digipoints_percentile = 0; // categorized digipoints with scale of 1-5
		var digipoints_analysis = "";

		var answers = []; //array of all answers as they are. First answer is the company name
		var answers_score = []; //array of each answer's score. First answer is company name which has score 0.
		var lastanswered = 0; //sequence number of the last already answered question to follow where user is

		var companyname = "";
		var imageRetrieved = false;

		function speak_aino(speechtext) {
			// meSpeak.speak calls the pause3D as callback when finished
			annyang.abort();
			hideIdle();
			responsiveVoice.speak(speechtext, "Finnish Female", {rate: 1.5});
			setTimeout(enterIdle, 6500);
			annyang.start();
		}

		function enterIdle() {
			$("#aino-talking").addClass("hidden");
			$("#aino-idle").removeClass("hidden");
			$("#aino-idle").animate({zIndex: 100, opacity: 1}, "slow");
		}

		function hideIdle() {
			$("#aino-talking").removeClass("hidden");
			$("#aino-idle").animate({zIndex: -100, opacity: 0}, "slow");
			$("#aino-idle").addClass("hidden");
		}

		function play3D() {
			//$( '#_play' ).prop('checked', true);
			$( '#_play' ).trigger('click');
			//$( '#_play' ).click(function() {console.log("play.click")});
		}

		function pause3D() {
			//$( '#_play' ).prop('checked', fal<se);
			$( '#_stop' ).trigger('click');
			//$( '#_stop' ).click(function() {console.log("stop.click")});
		}

		var f_AIno_initialize = function () {
			$("#intro").slideDown("slow");
			speak_aino('Tervehdys! Olen Ainobot, avustajasi digitalisaatiossa. Voit puhua minulle. Aloita sanomalla hei!');

		};

		// This function is called when the AIno 3D-model iframe is loaded
		function AIno_intro() {
			// JS way to have pause before calling f_AIno_initialize
			$('#aino-idle').ready(function () {
				enterIdle();
				hideIdle();
				setTimeout(f_AIno_initialize, 2000);
			});
			play3D();
		}


    if (annyang) {


      // define the functions our commands will run.
     	var hello = function() {
				$("#intro").slideUp("slow");
				$("#hei").slideDown("slow");
				scrollTo("#section_hei");
				//tarkista kuuleeko käyttäjä, jos ei kuule, vaihda pois responsivevoicesta
				speak_aino('Heipä hei! Hauska tutustua! Sanotko ensiksi yrityksesi tai organisaatiosi nimen mahdollisimman selkeästi? Aloita sanomalla "Nimi on"');
    	};

			var get_org = function(heard_org) {
				$("#hei").slideUp("slow");
        			$("#p_org").slideDown("slow");
				document.getElementById("aino_org").value = heard_org.toString();
				speak_aino('Kuulinko oikein, sanoitko '+ heard_org.toString());
				companyname = heard_org.toString();
				var url = encodeURI('https://html-page-reader-undiagramed-aerographer.eu-de.mybluemix.net/api/searchcomp?companyname=' + companyname);
				$.ajax({
					type: 'GET',
					url: url,
					async: true,
					dataType: 'json',
					success: function (data) {
						//alert(data.message);
						if (data.filename != 'url not found') {
							imageRetrieved = true;
						} else {
						speak_aino('Yritin etsiä yritystä mutta en löytänyt tiedoistani.');
						}
					}
				});

      };

			var got_name_right = function() {
				$("#p_org").slideUp("slow");
				$("#p_question1").slideDown("slow");
				companyname = document.getElementById("aino_org").value;

				answers[0] = companyname;
				answers_score[0] = 0;
				//käynnistä kuva- ja personallisuushaut askynkronisesti
				var url = encodeURI('https://html-page-reader-undiagramed-aerographer.eu-de.mybluemix.net/api/url2png?companyname=' + companyname);
				$.ajax({
					type: 'GET',
					url: url,
					async: true,
					dataType: 'json',
					success: function (data) {
						//alert(data.message);
						if (data.filename != 'url not found') {
							imageRetrieved = true;
						}
					}
				});

				var url = encodeURI('https://html-page-reader-undiagramed-aerographer.eu-de.mybluemix.net/api/simpleget?companyname=' + companyname);

				$.ajax({
					type: 'GET',
					url: url,
					async: false,
					dataType: 'json',
					success: function (data) {
						//alert(data.message);
						answers[4] = data.needs[0].percentile;
						answers_score[4] = data.needs[0].percentile;
						if( answers[4] ) {
						} else {
							answers[4]=0;
							answers_score[4];
						}
						console.log('percentile '+answers_score[4]);
					}
				});

				var url = 'https://html-page-reader-undiagramed-aerographer.eu-de.mybluemix.net/api/analyseimage?companyname=' + companyname;

				$.ajax({
					type: 'GET',
					url: url,
					async: false,
					dataType: 'json',
					success: function (data) {
						//alert(data.message);
						answers[5] = data.result;
						answers_score[5] = data.result;
						if( answers[5] ) {
						} else {
							answers[5]=0;
							answers_score[5];
						}
						console.log('image '+answers_score[5]);
						answers_score[5] = answers_score[5] * 2;
					}
				});

				speak_aino('Valitse paras vaihtoehto sanomalla vaihtoehdon teksti');
			}

			var next_question = function() {
				// calculate score
				// if lastanswered == 3 then present total and show form
				if( answers[lastanswered] ) {
				} else {
					answers[lastanswered]=0;
					answers_score[lastanswered]=0;
				}
				lastanswered++;
				console.log(lastanswered);
				let next = lastanswered+1;
				let qname = '#p_question'+next;
				$("#p_question"+lastanswered).slideUp("slow");
				$(qname).slideDown("slow");
				speak_aino('Kysymys numero'+next);
			}

			var choose_vastausA = function() {
				let answeredelement = lastanswered+1
				document.getElementById("vastausA"+answeredelement).checked = true;
				// push answer to array
				answers[lastanswered+1] = "A";
				answers_score[lastanswered+1] = 1;
			}
			var choose_vastausB = function() {
				let answeredelement = lastanswered+1
				document.getElementById("vastausB"+answeredelement).checked = true;
				answers[lastanswered+1] = "B";
				answers_score[lastanswered+1] = 0.75;
			}
			var choose_vastausC = function() {
				let answeredelement = lastanswered+1
				document.getElementById("vastausC"+answeredelement).checked = true;
				answers[lastanswered+1] = "C";
				answers_score[lastanswered+1] = 0.50;
			}
			var choose_vastausD = function() {
				let answeredelement = lastanswered+1
				document.getElementById("vastausD"+answeredelement).checked = true;
				answers[lastanswered+1] = "D";
				answers_score[lastanswered+1] = 0;
			}

			var high_score = function indexOfMax(arr) {
				    if (arr.length === 0) {
					return -1;
				    }

				    var max = arr[0];
				    var maxIndex = 0;

				    for (var i = 1; i < arr.length; i++) {
					if (arr[i] > max) {
					    maxIndex = i;
					    max = arr[i];
					}
				    }

				    return maxIndex;
				}

			var results = function() {
				//tulosta viestiä parin sekunnin välein että haku on käynnissä
				//hae website kuvan arvio
				//hae personallisuusarvio
				lastanswered++;
				digipoints_raw = answers_score[1]+answers_score[2]+answers_score[3]+answers_score[4]+answers_score[5]; //täydennä loput
				var hi_score = high_score(answers_score);
				var message = "";
				console.log("Max "+hi_score);
				if (digipoints_raw <= 1) {
				    digipoints_percentile = 1;
				    var message = "Tukevasti jalat digitalisaation tasolla 1: Älä kutsu digitalisaatiota unelmaksi. Sano että se on suunnitelma";
				} else if (digipoints_raw > 1 && digipoints_raw <= 2) {
				    digipoints_percentile = 2;
				    var message = "Ponnistelet digitalisaation tasolla 2: Ole utelias. Digitalisaatiota voi tehdä pienin askelin.";
				} else if (digipoints_raw > 2 && digipoints_raw <= 3) {
				    digipoints_percentile = 3;
				    var message = "Liidät digitalisaation tasolla 3: Seikkaile, avaa kumppaneille rajapintasi ja kehitä palveluita asiakkaidesi kanssa.";
				} else if (digipoints_raw > 3 && digipoints_raw <= 4) {
				    digipoints_percentile = 4;
				    var message = "Kukoistat digitalisaation tasolla 4: Aktivoidu! Kaikki kehitys tapahtuu mukavuusalueesi ulkopuolella";
				} else if (digipoints_raw > 4 && digipoints_raw <= 5) {
				    digipoints_percentile = 5;
				    var message = "Transendentiaalisella tasolla 5, digitalisaation mallioppilas. Rajapinnat auki, estetiikka kukkii ja diginatiivit, asiakaslähtöiset ratkaisut liitävät.";
				} else {
				    digipoints_percentile = 0;
				   var message = "Aino ei valitettavasti pystynyt arvioimaan digitalisaatiosi tasoa. Ehdotamme nettisivujen hankkimista / kääntämistä englanniksi Watsonille.";
				}
				//näytä tulos ja lyhyt lausunto ja kuva
				document.getElementById("aino_tulos").value = digipoints_percentile.toString();
				document.getElementById("result_img").src = hi_score.toString()+'.png';
				$("#recipient_message").val(hi_score.toString());
				$("#message_text").val(message.toString());
				$("#p_question"+lastanswered).slideUp("slow");
				$(section_email).slideDown("slow");
				console.log(answers[0]);
				console.log(answers[1]);
				console.log(answers[2]);
				console.log(answers[3]);
				console.log(answers[4]);
				console.log(answers[5]);
				console.log(answers_score[0]);
				console.log(answers_score[1]);
				console.log(answers_score[2]);
				console.log(answers_score[3]);
				console.log(answers_score[4]);
				console.log(answers_score[5]);
				console.log(digipoints_raw);
				console.log(digipoints_percentile);
				console.log(message);
			}

			var get_name = function(heard_name) {
				document.getElementById("recipient_name").value = heard_name.toString();
				document.getElementById("recipient_email").value = document.getElementById("recipient_name").value.replace(" ",".") + "@" + companyname + ".com";
				speak_aino('Kuulinko oikein, sanoitko '+heard_name.toString());
      			 };

	    var get_email = function(heard_email) {
				document.getElementById("recipient_email").value = heard_email.toString();
				speak_aino('Kuulinko oikein, sanoitko '+heard_email.toString());
      };

	    var send_form = function() {
				$( '#result_form' ).trigger('click');
				speak_aino('Lomake lähetetty');
      };

			var get_mirror = function() {
				speak_aino('O Lady Queen, though fair ye be, Snow-White is fairer far to see');
			};
	    		var dance = function() {
					hideAinoIdle();
					showAinoDancing();
					setTimeout(hideAinoDancing, 184800);
					setTimeout(sound.pause,184800);
					showAinoIdle();
			};

      // Let's define our first command. First the text we expect, and then the function it should call
      var commands = {
        			'hei': hello,
				'nimi on *hear_org':  get_org,
				'nimi oikein': got_name_right,
				'vastaus A': choose_vastausA,
	      			'vastaus B': choose_vastausB,
				'vastaus C': choose_vastausC,
				'vastaus D': choose_vastausD,
	      			'seuraava kysymys': next_question,
	      			'tulos': results,
	      			'nimeni on *hear_name': get_name,
	      			'sähköpostiosoitteeni on *hear_email': get_email,
	      			'lähetä lomake': send_form,
				'kerro kerro *hear_kerro': get_mirror,
	      			'tanssi': dance

      };

      // OPTIONAL: activate debug mode for detailed logging in the console
      annyang.debug();

      // Add our commands to annyang
      annyang.addCommands(commands);

      // OPTIONAL: Set a language for speech recognition (defaults to English)
      // For a full list of language codes, see the documentation:
      // https://github.com/TalAter/annyang/blob/master/docs/FAQ.md#what-languages-are-supported
      annyang.setLanguage('fi');

	// Start listening, don't restart automatically, stop recognition after first phrase recognized
	annyang.start({ autoRestart: false, continuous: false });

			var scrollTo = function(identifier, speed) {
		    $('html, body').animate({
		        scrollTop: $(identifier).offset().top
		    }, speed || 1000);
		  }
    } else {
      $(document).ready(function() {
        $('#unsupported').fadeIn('fast');
      });
    }


    </script>

	</body>
</html>
